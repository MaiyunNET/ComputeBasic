/*
 * ComputeBasic 0.0.1
 */
"use strict";var ComputeBasicWordType;!function(e){e[e.NORMAL=0]="NORMAL",e[e.STRING=1]="STRING",e[e.COMMENT=2]="COMMENT",e[e.LF=3]="LF"}(ComputeBasicWordType||(ComputeBasicWordType={}));var ComputeBasic=function(){function e(){this.lang="en-us",this._funcs={ceil:function(e){return Math.ceil(e)}},this._langMsg={"en-us":{error:"CB Error",code:"Code",message:"Message",row:"Line",col:"Column",word:"Word",codeMessage:{0:"Functions and variables can not begin with a number",1:"Function does not exist",2:"Unrecognized statement",3:"Runtime error"}},"zh-cn":{error:"CB 执行错误",code:"错误码",message:"错误信息",row:"行",col:"列",word:"词",codeMessage:{0:"函数和变量不能以数字开头",1:"函数不存在",2:"无法识别的语句",3:"运行时错误"}}}}return e.prototype.expose=function(e,s){this._funcs[e]=s},e.prototype._tokenizer=function(e){e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var s=e.match(/([\s\S]{1})/g);if(null!==s){for(var r=[],o=!1,t=[],a=!1,n=!1,i=1,l=1,u=0;u<s.length;++u){var c=s[u];if(n)if("\n"===c){n=!1;var h=t.join("");r.push({word:h,lower:h.toLowerCase(),type:ComputeBasicWordType.COMMENT,row:i,col:l}),++i,l=1}else"\\"===c?t.push("\\\\"):t.push(c);else if(a)if('"'===c){if(!s[u-1]||'"'!==s[u-1])if(s[u+1]&&'"'===s[u+1])t.push("\\"+c);else{a=!1;var p=t.join("");r.push({word:p,lower:p.toLowerCase(),type:ComputeBasicWordType.STRING,row:i,col:l}),l+=p.length}}else"\\"===c?t.push("\\\\"):t.push(c);else if(/^[\u4e00-\u9fbf_a-zA-Z0-9]$/.test(c))o?t.push(c):(o=!0,t=[c]);else{var g=!0;if(o)if("."===c&&/^[0-9]+$/.test(t.join("")))t.push(c),g=!1;else{o=!1;var p=t.join("");r.push({word:p,lower:p.toLowerCase(),type:ComputeBasicWordType.NORMAL,row:i,col:l}),l+=p.length}g&&(" "!==c&&"\t"!==c?'"'===c?(a=!0,t=[]):"'"===c?(n=!0,t=[]):"\n"===c?(r.push({word:c,lower:c.toLowerCase(),type:ComputeBasicWordType.LF,row:i,col:l}),++i,l=1):(r.push({word:c,lower:c.toLowerCase(),type:ComputeBasicWordType.NORMAL,row:i,col:l}),++l):++l)}}if(o){var h=t.join("");r.push({word:h,lower:h.toLowerCase(),type:ComputeBasicWordType.NORMAL,row:i,col:l})}return r}return[]},e.prototype._error=function(e,s){s.word?alert(this._langMsg[this.lang].error+":\n"+this._langMsg[this.lang].code+": "+e+"\n"+this._langMsg[this.lang].message+": "+this._langMsg[this.lang].codeMessage[e]+"\n"+this._langMsg[this.lang].word+"："+s.word+"\n"+this._langMsg[this.lang].row+": "+s.row+"\n"+this._langMsg[this.lang].col+": "+s.col):alert(this._langMsg[this.lang].error+":\n"+this._langMsg[this.lang].code+": "+e+"\n"+this._langMsg[this.lang].message+": "+this._langMsg[this.lang].codeMessage[e]+"\n"+s)},e.prototype.compiler=function(e,s){for(var r=this._tokenizer(e),o=[],t=[],a=[],n=!1,i=!1,l=!1,u=!1,c=0;c<r.length;++c){var h=r[c];if(h.type===ComputeBasicWordType.STRING)o.push('"'+h.word+'"');else if(h.type===ComputeBasicWordType.LF){var p=r[c-1];(!p||"then"!==p.lower&&"if"!==p.lower&&"else"!==p.lower&&"elseif"!==p.lower&&"\n"!==p.lower)&&o.push(";")}else if(h.type===ComputeBasicWordType.NORMAL){var g=h.word,f=g.toLowerCase();switch(f){case"if":i?(o.push("}"),i=!1):(o.push("if("),n=!0,l&&(l=!1));break;case"then":o.push("){"),n=!1;break;case"else":r[c+1]&&"if"===r[c+1].lower?(o.push("}else "),l=!0):o.push("}else{");break;case"elseif":o.push("}else if("),n=!0;break;case"end":i=!0;break;case"=":n&&(!r[c-1]||">"!==r[c-1].word&&"<"!==r[c-1].word)?o.push("=="):o.push("=");break;case">":case"<":case"(":case")":case"+":case"-":case"*":case"/":o.push(f);break;case"&":o.push("+");break;case"return":o.push(f+" ");break;case"and":o.push("&&");break;case"or":o.push("||");break;case/[0-9]+?/.test(f)&&f:o.push(g);break;case"[":u=!0;break;case"]":u&&(u=!1);break;default:if(u)-1===t.indexOf(g)&&t.push(g),o.push("el_"+g+".value");else if(r[c+1]&&"("===r[c+1].word){if(!this._funcs[f])return this._error(1,h),!1;o.push(f)}else{if(!/^[\u4e00-\u9fbf_a-z0-9]+$/.test(f))return this._error(2,h),!1;if(/^[0-9]$/.test(f.slice(0,1)))return this._error(0,h),!1;-1===a.indexOf("var_"+f)&&a.push("var_"+f),o.push("var_"+f)}}}}if(a.length>0&&o.splice(0,0,"var "+a.join(",")+";"),t.length>0)for(var w=0,d=t;w<d.length;w++){var _=d[w];o.splice(0,0,"var el_"+_+"=document.querySelector(\"[name='"+_+"']\");")}for(var M in this._funcs){var v=this._funcs[M];o.splice(0,0,"var "+M+"="+v.toString()+";")}if(s&&!0===s.string)return o.join("");try{return new Function(o.join(""))}catch(e){return this._error(3,e),!1}},e.verison="0.0.1",e}();